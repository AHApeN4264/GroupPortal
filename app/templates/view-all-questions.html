{% extends 'base.html' %}
{% load static %}

{% block title %}
    <title>Усі питання</title>
{% endblock %}

{% block body %}
<h2>Усі питання</h2>

<form method="get" style="margin: 10px 0;">
    <label>Назва питання:
      <input type="text" name="title" value="{{ title_query }}" placeholder="Пошук...">
    </label>
    <button type="submit">Знайти</button>
</form>

{% if questions %}
    <div style="display: flex; flex-direction: column; gap: 20px;">
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center">
            {% if messages_list.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page={{ messages_list.previous_page_number }}">Назад</a>
              </li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">Назад</span></li>
            {% endif %}
          
            {% for num in messages_list.paginator.page_range %}
              {% if messages_list.number == num %}
                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
              {% else %}
                <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
              {% endif %}
            {% endfor %}
          
            {% if messages_list.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ messages_list.next_page_number }}">Вперед</a>
              </li>
            {% else %}
              <li class="page-item disabled"><span class="page-link">Вперед</span></li>
            {% endif %}
          </ul>
        </nav>
        {% for q in questions %}
            <a href="{% url 'view-question' id=q.id %}" style="text-decoration: none; color: inherit;">
                <div style="background: #f2f2f2; border: 1px solid #ccc; border-radius: 8px; padding: 15px; transition: 0.2s;">

                    <div style="display: flex; align-items: center; gap: 10px;">
                        <h3 style="margin: 0; color: #000000;">{{ q.title }}</h3>
                        <span style="font-size: 12px; color: #666;">
                            {% if q.approved_at %}
                                {{ q.approved_at|date:"d.m.Y H:i" }}
                            {% else %}
                                {{ q.created_at|date:"d.m.Y H:i" }}
                            {% endif %}
                        </span>
                    </div>


                    <p style="margin: 10px 0 0; color: #333;">{{ q.quest }}</p>

                    <p style="margin: 5px 0 0; font-size: 12px; color: #666;">
                        Коментарів: {{ q.comments.count }}
                    </p>
                
                    {% if q.owner == request.user or role == "Модератор" or role == "Адміністратор" %}
                        <a href="{% url 'delete-question' id=q.id %}" 
                           style="color:red; font-weight:bold; display:inline-block; margin-top:5px; text-decoration: none;"
                           onclick="return confirm('Ви точно хочете видалити завдання?')">
                           Видалити
                        </a>
                    {% endif %}
                </div>
            </a>
        {% endfor %}
    </div>
{% else %}
    <p>Не знайдено питань</p>
{% endif %}

{% endblock %}
