{% extends 'base.html' %}
{% load static %}

{% block title %}
<title>–®–∫—ñ–ª—å–Ω–∏–π —Å–∞–π—Ç ‚Äî –û—Ü—ñ–Ω–∫–∏</title>
<style>
  body {
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f9;
  }

  main {
    width: 100%;
    padding: 0;
    margin: 0;
  }

  .card {
    border: none;
    border-radius: 0;
    box-shadow: none;
  }

  .card-body {
    width: 100%;
    padding: 0;
  }

  .table-hover tbody tr:hover {
    background-color: #f1f5ff;
  }

  .table-responsive {
    width: 100%;
    margin: 0;
    padding: 0;
  }

  .message {
    color: green;
    margin-left: 16px;
  }

  .error-msg {
    color: red;
    margin-left: 16px;
  }

  nav {
    margin-top: 20px;
  }
</style>
{% endblock %}

{% block body %}
<main>
  <div class="card shadow-sm">
    <div class="card-body">

      {% if messages %}
        {% for message in messages %}
          <p class="{% if message.tags == 'success' %}message{% else %}error-msg{% endif %}">
            {{ message }}
          </p>
        {% endfor %}
      {% endif %}

      <div class="table-responsive mb-3">
        <table class="table table-hover mb-0 w-100">
          <thead class="table-secondary">
            <tr>
              <th style="width:60px;">#</th>
              <th>–£—á–µ–Ω—å</th>
              <th>–ö–ª–∞—Å</th>
              <th>–ü—Ä–µ–¥–º–µ—Ç</th>
              <th style="width:120px;">–û—Ü—ñ–Ω–∫–∞</th>
              <th style="width:160px;">–î–∞—Ç–∞</th>
              <th style="width:220px;">–î—ñ—è</th>
            </tr>
          </thead>
          <tbody>
          {% for g in grades %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ g.student_name }}</td>
              <td>{{ g.student_class|default:"‚Äî" }}</td>
              <td>{{ g.subject|default:"‚Äî" }}</td>
              <td class="fw-bold">{{ g.grade }}</td>
              <td>{{ g.created_at|date:"Y-m-d H:i" }}</td>
              <td>
                <a href="{% url 'grade_edit' g.pk %}" class="btn btn-sm btn-outline-warning me-1">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
              
                {% if role == "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä" or role == "–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä" %}
                <form method="post" action="{% url 'grade_delete' g.pk %}" style="display:inline-block"
                      onsubmit="return confirm('–í–∏ –¥—ñ–π—Å–Ω–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—å–æ–≥–æ —É—á–Ω—è?');">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-outline-danger">üóë –í–∏–¥–∞–ª–∏—Ç–∏</button>
                </form>
                {% endif %}
              
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="7" class="text-center py-4 text-muted">–£—á–Ω—ñ–≤ —â–µ –Ω–µ–º–∞—î.</td>
            </tr>
          {% endfor %}
        </tbody>
        </table>
      </div>

      {% if role == "–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä" or role == "–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä" %}
      <div class="text-end mt-4">
        <form method="post">
          {% csrf_token %}
          <button type="submit" name="add_student" class="btn btn-primary">
            + –î–æ–¥–∞—Ç–∏ —É—á–Ω—è
          </button>
        </form>
      </div>
      {% endif %}

  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      {% if grades.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{ grades.previous_page_number }}">–ù–∞–∑–∞–¥</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">–ù–∞–∑–∞–¥</span></li>
      {% endif %}

      {% for num in grades.paginator.page_range %}
        {% if grades.number == num %}
          <li class="page-item active"><span class="page-link">{{ num }}</span></li>
        {% else %}
          <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
        {% endif %}
      {% endfor %}

      {% if grades.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ grades.next_page_number }}">–í–ø–µ—Ä–µ–¥</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">–í–ø–µ—Ä–µ–¥</span></li>
      {% endif %}
    </ul>
  </nav>
  </div>
</main>
{% endblock %}
